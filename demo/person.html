<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Person</title>
    <style>
        body, html {
            padding: 10px;
            margin: 0;
        }
        label {
            display: inline-block;
            width: 80px;
            text-align: right;
            padding-right: 10px;
        }
        #avatar {
            display: inline-block;
            width: 100px;
            height: 120px;
            border: 1px solid #000;
            margin-left: 10px;
            line-height: 100px;
            text-align: center;
        }
        form {
            float: left;
        }
    </style>
</head>
<body>
    <div id="avatar"></div>
    <form>
        <div><label>姓名：</label><input id="name" type="text" value=""></div>
        <div><label>出生年月：</label>
          <select id="birth-year">
            <option>1995年</option>
            <option>1996年</option>
            <option>1997年</option>
            <option>1998年</option>
            <option>1999年</option>
            <option>2000年</option>
            <option>2001年</option>
            <option>2002年</option>
            <option>2003年</option>
            <option>2004年</option>
            <option>2005年</option>
            <option>2006年</option>
            <option>2007年</option>
          </select>
          <select id="birth-month">
            <option>1月</option>
            <option>2月</option>
            <option>3月</option>
            <option>4月</option>
            <option>5月</option>
            <option>6月</option>
            <option>7月</option>
            <option>8月</option>
            <option>9月</option>
            <option>10月</option>
            <option>11月</option>
            <option>12月</option>
          </select>
        </div>

        <div><label>年龄：</label><input id="age" type="text" value="" readonly></div>
        <div><label>用户画像：</label><input id="portrait" type="text" value="" readonly></div>
    </form>

    <script>
        class Person {
            constructor({name, birthday}) {
                this._name = name;
                const date = new Date(birthday);
                this._birthYear = date.getFullYear();
                this._birthMonth = date.getMonth() + 1;
            }

            get name() {
                return this._name;
            }

            set name(value) {
                this._name = value;
            }

            get birthday() {
                return {
                    year: this._birthYear,
                    month: this._birthMonth
                };
            }

            set birthday({year = this._birthYear, month = this._birthMonth}) {
                this._birthYear = year;
                this._birthMonth = month;
            }

            get age() {
                return new Date().getFullYear() - this._birthYear;
            }

            get portrait() {
                return this.age <= 18 ? '少年' : '成年';
            }
        }

        const avatar = document.getElementById('avatar');
        const name = document.getElementById('name');
        const birthYear = document.getElementById('birth-year');
        const birthMonth = document.getElementById('birth-month');
        const age = document.getElementById('age');
        const portrait = document.getElementById('portrait');

        function updatePerson(person) {
            name.value = person.name;
            const {year, month} = person.birthday;
            birthYear.value = `${year}年`;
            birthMonth.value = `${month}月`;
            age.value = `${person.age}岁`;
            portrait.value = person.portrait;
            avatar.innerHTML = person.name;
        }

        function watch(obj, onchange) {
            return new Proxy(obj, {
                // set: function(target, property, value, receiver)
                set(target, name, value) {
                    target[name] = value;
                    onchange(target);
                    // The set method should return a boolean value, return true to indicate that assignment succeeded
                    return true; 
                },
            });
        }

        let p = new Person({name: '张三', birthday: '1999-12'});
        updatePerson(p);

        p = watch(p, (obj) => updatePerson(obj));
      
        // now p is not a normal object, it is a Proxy which can intercept custom behavior
        name.addEventListener('input', (e) => {
            p.name = e.target.value;
        });

        birthYear.addEventListener('change', (e) => {
            p.birthday = {year: parseInt(e.target.value, 10)};
        });

        birthMonth.addEventListener('change', (e) => {
            p.birthday = {month: parseInt(e.target.value, 10)};
        });
    </script>
</body>
</html>